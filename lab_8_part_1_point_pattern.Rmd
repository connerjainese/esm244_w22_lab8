---
title: "lab_8_part_1_point_pattern"
author: "conner jainese"
date: "2/24/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(spatstat)
library(raster) # before tidyverse because of select() function
library(maptools)
library(tidyverse)
library(here)
library(sf)
library(tmap)
```



This is an example of point pattern analysis with a density plot, and the G- & L- function (distance methods) to compare our observed points with simulated complete spatial randomness.

```{r}
# Read in the tree vole data
voles <- read_sf(dsn = here("redtreevoledata"), #dsn = "data source name"
                 layer = "ds033") %>% 
  janitor::clean_names() %>%
  select(county) %>% # Only select the county attribute
  filter(county == "HUM") %>% # Only keep observations in Humboldt County
  st_transform(crs = 32610) # Update CRS to UTM zone 10 N
 
# Plot it (exploratory)
plot(voles)
 
# Get Humboldt County outline
humboldt <- read_sf(dsn = here("redtreevoledata"), 
                    layer = "california_county_shape_file") %>% 
  janitor::clean_names() %>%
  filter(name == "Humboldt") %>% # Isolate Humboldt County
  select(name) %>% # Only keep one attribute (name) to simplify
  # .prj file is missing, but we know the coordinate system so we can assign it here
  st_set_crs(4326) %>%  
  st_transform(crs = 32610)
 
# plot them together
ggplot() +
  geom_sf(data = humboldt, 
          color = "darkorchid", 
          fill = "darkorchid4", 
          size = 1) +
  geom_sf(data = voles, 
          color = "orange", 
          alpha = 0.7, 
          size = 2) +
  theme_minimal()
```


These need to be combined into spatial point pattern data (points + window combo), and for point pattern analysis this **requires a 2D projection** (in this case, UTM), which is why we set the CRS to 32610 above. This looks quite a bit different from what we've done so far - it uses functions in `spatstat` to create point patterns that play nicely with other functions for data viz & point pattern analysis.

```{r}
voles_sp  <- as(voles,"Spatial") # Convert to object 'Spatial'
voles_ppp <- as(voles_sp, "ppp") # Convert to spatial point pattern
 
humboldt_sp  <- as(humboldt, "Spatial") # Convert to object 'Spatial'
humboldt_win <- as(humboldt_sp, "owin") # Convert to spatial point pattern from spatstat
 
# Combine as a point pattern object (points + window):
voles_full <- ppp(voles_ppp$x, voles_ppp$y, window = humboldt_win)
 
plot(voles_full) # Illegal point (outside window) shows up as the plus sign
```









